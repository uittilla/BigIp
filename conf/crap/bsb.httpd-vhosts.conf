#
# $host  => hostname
# $port  => connection port
# $dir   => docroot
# $rport => redirect port
#
<Macro VHost $host $port $dir $rport>
 <VirtualHost *:$port>

    ServerName   $host
    ServerAlias  $host
    DocumentRoot $dir

    <Directory "/">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order deny,allow
        Deny from all
    </Directory>

    <Directory $dir>
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order allow,deny
        Allow from all
        AllowOverride All
    </Directory>

    # TransferLog "|/usr/bin/cronolog /export/bigIP/logs/eu/%Y/%m/%d/spoofBigIp_access_log"
    # ErrorLog    "|/usr/bin/cronolog /export/bigIP/logs/eu/%Y/%m/%d/spoofBigIp_error_log"

    ProxyRequests Off
    RewriteEngine On

    RewriteRule ^/(.*) http://127.0.0.1:$rport/$1 [P]
    ProxyPassReverse /  http://127.0.0.1:$rport

    ProxyPreserveHost On

    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    BrowserMatch ^Mozilla/4\.0[678] no-gzip

 </VirtualHost>
</Macro>
 
#### host:80 ####

# Handled by real bigIP


#Use VHost bsb.www.manheim.co.uk         		80 /export/mol-uk/manheim.co.uk			8000	
#Use VHost bsb.www.manheimremarketing.co.uk    	80 /export/mol-uk/manheimremarketing.co.uk	8000


# Still handled here

Use VHost bsb.www.manheim.fr     			80 /home/bbishop/src/mol-eu/docroot 61080

Use VHost bsb.www.lexus-exchange.eu         80 /home/bbishop/src/mol-eu/docroot 61080

Use VHost bsb.www.manheim.de     			80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.manheim.es     			80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.manheim.pt     			80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.manheim.it     			80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.manheim.be     			80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.manheim.eu     			80 /home/bbishop/src/mol-eu/docroot 61080

Use VHost bsb.www.falfleetvo.com     		80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.chryslerespana.com     		80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.fiat-cyberstock.com     		80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.hyundaiespana.com     		80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.hyundai-vo.com      	        80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.mercedes-benz-industrialesespana.com     80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.nreestreno.com     		80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.peugeot-cyberstock.com     	80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.spainusedvans.com     		80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.stockempleados.com     		80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.tfs-cars.com     			80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.toyotaespana.com     		80 /home/bbishop/src/mol-eu/docroot 61080
Use VHost bsb.www.ventesvo.ingcarlease.fr     	80 /home/bbishop/src/mol-eu/docroot 61080


<Macro SSLHostMacro $host $port $dir $rport>
   <VirtualHost *:$port>

    ServerName   $host
    ServerAlias  $host
    DocumentRoot $dir

    <Directory "/">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order deny,allow
        Deny from all
    </Directory>

    <Directory $dir>
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order allow,deny
        Allow from all
        AllowOverride All
    </Directory>

    # TransferLog "|/usr/bin/cronolog /export/bigIP/logs/eu/%Y/%m/%d/spoofBigIp_access_log"
    # ErrorLog    "|/usr/bin/cronolog /export/bigIP/logs/eu/%Y/%m/%d/spoofBigIp_error_log"

    ProxyRequests Off
    RewriteEngine On


    RewriteRule ^/(.*) http://$host:$rport/$1 [P]
    ProxyPassReverse / http://$host:$rport/
    ProxyPreserveHost On 

    <IfModule mod_ssl.c>
      SSLEngine on
      SSLProxyEngine On
      SSLCipherSuite ALL:!ADH:!EXPORT56:-AES256-SHA:-DHE-RSA-AES256-SHA:-DHE-DSS-AES256-SHA:RC4+RSA:+HIGH:+MEDIUM:+LOW:!SSLv2:+EXP:+eNULL
      SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
      SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

      BrowserMatch ".*MSIE.*" \
                 nokeepalive ssl-unclean-shutdown \
                 downgrade-1.0 force-response-1.0
      BrowserMatch ^Mozilla/4\.0[678] no-gzip
    </ifModule>

  </VirtualHost>

</Macro>

#### host:443 ####


# Handled by real bigIP


# Still handled here

#Use SSLHostMacro bsb.www.manheimremarketing.co.uk              443 /export/mol-uk/manheimremarketing.co.uk    8443
#Use SSLHostMacro bsb.www.manheim.co.uk                         443 /export/mol-uk/manheim.co.uk    		8443


Use SSLHostMacro bsb.www.manheim.fr                            443 /home/bbishop/src/mol-eu/docroot 61043

Use SSLHostMacro bsb.www.manheim.de                            443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.manheim.es                            443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.manheim.pt                            443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.manheim.it                            443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.manheim.be                            443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.manheim.eu                            443 /home/bbishop/src/mol-eu/docroot 61043

Use SSLHostMacro bsb.www.falfleetvo.com                        443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.chryslerespana.com                    443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.fiat-cyberstock.com                   443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.hyundaiespana.com                     443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.hyundai-vo.com                        443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.mercedes-benz-industrialesespana.com  443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.nreestreno.com                        443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.peugeot-cyberstock.com                443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.spainusedvans.com                     443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.stockempleados.com                    443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.tfs-cars.com                          443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.toyotaespana.com                      443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.ventesvo.ingcarlease.fr               443 /home/bbishop/src/mol-eu/docroot 61043
Use SSLHostMacro bsb.www.lexus-exchange.eu                     443 /home/bbishop/src/mol-eu/docroot 61043
