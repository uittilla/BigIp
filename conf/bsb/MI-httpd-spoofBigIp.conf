# Author Mark Ibbotson
# Purpose: 
# Spoof the actions of BigIp, I.E. forward all requests on port 80 to accel on port 8000
#                                  forward all requests on 443 to accel on port 8443
#
# Todo:
# Map requests for all UK and EU dev domains and direct traffic accordingly
#

LoadModule authz_default_module /usr/lib/apache2/modules/mod_authz_default.so
LoadModule authz_host_module    /usr/lib/apache2/modules/mod_authz_host.so
LoadModule deflate_module       /usr/lib/apache2/modules/mod_deflate.so
LoadModule env_module           /usr/lib/apache2/modules/mod_env.so
LoadModule headers_module       /usr/lib/apache2/modules/mod_headers.so
LoadModule setenvif_module      /usr/lib/apache2/modules/mod_setenvif.so
LoadModule proxy_module         /usr/lib/apache2/modules/mod_proxy.so
LoadModule proxy_http_module    /usr/lib/apache2/modules/mod_proxy_http.so
LoadModule mime_module          /usr/lib/apache2/modules/mod_mime.so
LoadModule status_module        /usr/lib/apache2/modules/mod_status.so
LoadModule vhost_alias_module   /usr/lib/apache2/modules/mod_vhost_alias.so
LoadModule alias_module         /usr/lib/apache2/modules/mod_alias.so
LoadModule rewrite_module       /usr/lib/apache2/modules/mod_rewrite.so
LoadModule auth_tkt_module      /usr/lib/apache2/modules/mod_auth_tkt.so
LoadModule expires_module       /usr/lib/apache2/modules/mod_expires.so
LoadModule ssl_module 		/usr/lib/apache2/modules/mod_ssl.so

Timeout 300
KeepAlive On
MaxKeepAliveRequests 500
KeepAliveTimeout 60

<IfDefine PROD>
User nobody
Group web

StartServers        1 
ServerLimit         100
ThreadsPerChild     25
MaxClients          500
MinSpareThreads     125
MaxSpareThreads     350
MaxRequestsPerChild 0
</IfDefine>

<IfDefine STAGE>
User nobody
Group web

StartServers        3
ServerLimit         35
ThreadsPerChild     15
MaxClients          150
MinSpareThreads     25
MaxSpareThreads     50
MaxRequestsPerChild 0
</IfDefine>

<IfDefine DEV>
User bounce
Group web

StartServers        3
ServerLimit         20
ThreadsPerChild     5
MaxClients          100
MinSpareThreads     5
MaxSpareThreads     10
MaxRequestsPerChild 0
</IfDefine>

Listen 80
Listen 443

NameVirtualHost *:80
NameVirtualHost *:443

ServerAdmin mark.ibbotson@manheimeurope.com
HostnameLookups off
UseCanonicalName Off

EnableMMAP off
EnableSendfile off

LogLevel notice 
LogFormat "%{OrigClientAddr}i %l %u %t \"%r\" %>s %b \"%{Referer}i\""

LockFile /tmp/mol-uk/spoofBigIp.lock
PidFile  /export/mol-uk/logs/uk-spoofBigIp-httpd.pid
TransferLog "|/usr/bin/cronolog /export/logs/mol-uk-default/%Y/%m/%d/spoofBigIp_access_log"
ErrorLog    "|/usr/bin/cronolog /export/logs/mol-uk-default/%Y/%m/%d/spoofBigIp_error_log"

#### Port 80 Virtual hosts
# UK, DE, SP, ES, IT, PT, EU, BE

<VirtualHost *:80>
    ServerName ukleelx01.manheim.co.uk
    ServerAlias ukleelx01
    DocumentRoot /export/mol-uk/manheim.co.uk

    <Directory "/">
        Order deny,allow
        Deny from all
    </Directory>

    <Directory "/export/mol-uk/manheim.co.uk">
        Options FollowSymLinks
        Order allow,deny
        Allow from all
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheim.co.uk/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheim.co.uk/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On

    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    
    RewriteRule ^(.*)$ http://ukleelx01.manheim.co.uk$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]

    # everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:8000/$1 [P]
    ProxyPassReverse /  http://127.0.0.1:8000/
    ProxyPreserveHost On

    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

### GERMANY 
<VirtualHost *:80>
    ServerName dev.www.manheim.de
    ServerAlias dev.www.manheim.de
    DocumentRoot /export/manheimdirect.com/docroot 
   
    <Directory "/">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order deny,allow
        Deny from all
    </Directory>

    <Directory "/export/manheimdirect.com/docroot">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order allow,deny
        Allow from all
        AllowOverride All
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On

    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    RewriteRule ^(.*)$ http://dev.www.manheim.de$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]

    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7000/$1 [P]
    ProxyPassReverse /  http://127.0.0.1:7000/
    ProxyPreserveHost On

    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

### FRANCE
<VirtualHost *:80>
    ServerName dev.www.manheim.fr
    ServerAlias dev.www.manheim.fr
    DocumentRoot /export/manheimdirect.com/docroot

    <Directory "/">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order deny,allow
        Deny from all
    </Directory>

    <Directory "/export/manheimdirect.com/docroot">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order allow,deny
        Allow from all
        AllowOverride All
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On

    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.fr$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]

    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7000/$1 [P]
    ProxyPassReverse /  http://127.0.0.1:7000/
    ProxyPreserveHost On

    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

### SPAIN
<VirtualHost *:80>
    ServerName dev.www.manheim.es
    ServerAlias dev.www.manheim.es
    DocumentRoot /export/manheimdirect.com/docroot

    <Directory "/">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order deny,allow
        Deny from all
    </Directory>

    <Directory "/export/manheimdirect.com/docroot">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order allow,deny
        Allow from all
        AllowOverride All
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On

    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.es$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]

    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7000/$1 [P]
    ProxyPassReverse /  http://127.0.0.1:7000/
    ProxyPreserveHost On

    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

### PORTUGAL
<VirtualHost *:80>
    ServerName dev.www.manheim.pt
    ServerAlias dev.www.manheim.pt
    DocumentRoot /export/manheimdirect.com/docroot

    <Directory "/">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order deny,allow
        Deny from all
    </Directory>

    <Directory "/export/manheimdirect.com/docroot">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order allow,deny
        Allow from all
        AllowOverride All
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On

    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.pt$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]

    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7000/$1 [P]
    ProxyPassReverse /  http://127.0.0.1:7000/
    ProxyPreserveHost On

    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

### ITALY
<VirtualHost *:80>
    ServerName dev.www.manheim.it
    ServerAlias dev.www.manheim.it
    DocumentRoot /export/manheimdirect.com/docroot

    <Directory "/">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order deny,allow
        Deny from all
    </Directory>

    <Directory "/export/manheimdirect.com/docroot">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order allow,deny
        Allow from all
        AllowOverride All
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On

    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.it$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]

    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7000/$1 [P]
    ProxyPassReverse /  http://127.0.0.1:7000/
    ProxyPreserveHost On

    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

### BELGUIM
<VirtualHost *:80>
    ServerName dev.www.manheim.be
    ServerAlias dev.www.manheim.be
    DocumentRoot /export/manheimdirect.com/docroot

    <Directory "/">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order deny,allow
        Deny from all
    </Directory>

    <Directory "/export/manheimdirect.com/docroot">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order allow,deny
        Allow from all
        AllowOverride All
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On

    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.be$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]

    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7000/$1 [P]
    ProxyPassReverse /  http://127.0.0.1:7000/
    ProxyPreserveHost On

    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

### BELGUIM
<VirtualHost *:80>
    ServerName dev.www.manheim.eu
    ServerAlias dev.www.manheim.eu
    DocumentRoot /export/manheimdirect.com/docroot

    <Directory "/">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order deny,allow
        Deny from all
    </Directory>

    <Directory "/export/manheimdirect.com/docroot">
        Options +ExecCGI +FollowSymLinks +MultiViews +Includes -Indexes
        Order allow,deny
        Allow from all
        AllowOverride All
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On

    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.eu$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]

    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7000/$1 [P]
    ProxyPassReverse /  http://127.0.0.1:7000/
    ProxyPreserveHost On

    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>


<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName ukleelx01.manheim.co.uk
    ServerAlias ukleelx01
    DocumentRoot /export/mol-uk/manheim.co.uk

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
    <Directory "/">
        Order deny,allow
        Deny from all
    </Directory>
    <Directory "/export/mol-uk/manheim.co.uk">
        Options FollowSymLinks
        Order allow,deny
        Allow from all
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheim.co.uk/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheim.co.uk/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On
    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://ukleelx01.manheim.co.uk$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]
    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:8443 [P]
    ProxyPassReverse /  http://127.0.0.1:8443
    ProxyPreserveHost On
    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    SSLEngine on
    SSLProxyEngine On
    SSLCipherSuite ALL:!ADH:!EXPORT56:-AES256-SHA:-DHE-RSA-AES256-SHA:-DHE-DSS-AES256-SHA:RC4+RSA:+HIGH:+MEDIUM:+LOW:!SSLv2:+EXP:+eNULL
    LogLevel notice 
    SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    BrowserMatch ".*MSIE.*" \
                nokeepalive ssl-unclean-shutdown \
                downgrade-1.0 force-response-1.0
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

## GERMANY
<VirtualHost *:443>
    ServerName dev.www.manheim.de
    ServerAlias dev.www.manheim.de
    DocumentRoot /export/manheimdirect.com/docroot

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
    <Directory "/">
        Order deny,allow
        Deny from all
    </Directory>
    <Directory "/export/manheimdirect.com/docroot">
        Options FollowSymLinks
        Order allow,deny
        Allow from all
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheim.direct.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On
    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.de$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]
    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7443 [P]
    ProxyPassReverse /  http://127.0.0.1:7443
    ProxyPreserveHost On
    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    SSLEngine on
    SSLProxyEngine On
    SSLCipherSuite ALL:!ADH:!EXPORT56:-AES256-SHA:-DHE-RSA-AES256-SHA:-DHE-DSS-AES256-SHA:RC4+RSA:+HIGH:+MEDIUM:+LOW:!SSLv2:+EXP:+eNULL
    LogLevel notice
    SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    BrowserMatch ".*MSIE.*" \
                nokeepalive ssl-unclean-shutdown \
                downgrade-1.0 force-response-1.0
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

## FRANCE
<VirtualHost *:443>
    ServerName dev.www.manheim.fr
    ServerAlias dev.www.manheim.fr
    DocumentRoot /export/manheimdirect.com/docroot

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
    <Directory "/">
        Order deny,allow
        Deny from all
    </Directory>
    <Directory "/export/manheimdirect.com/docroot">
        Options FollowSymLinks
        Order allow,deny
        Allow from all
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheim.direct.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On
    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.fr$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]
    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7443 [P]
    ProxyPassReverse /  http://127.0.0.1:7443
    ProxyPreserveHost On
    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    SSLEngine on
    SSLProxyEngine On
    SSLCipherSuite ALL:!ADH:!EXPORT56:-AES256-SHA:-DHE-RSA-AES256-SHA:-DHE-DSS-AES256-SHA:RC4+RSA:+HIGH:+MEDIUM:+LOW:!SSLv2:+EXP:+eNULL
    LogLevel notice
    SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    BrowserMatch ".*MSIE.*" \
                nokeepalive ssl-unclean-shutdown \
                downgrade-1.0 force-response-1.0
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

## SPAIN
<VirtualHost *:443>
    ServerName dev.www.manheim.es
    ServerAlias dev.www.manheim.es
    DocumentRoot /export/manheimdirect.com/docroot

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
    <Directory "/">
        Order deny,allow
        Deny from all
    </Directory>
    <Directory "/export/manheimdirect.com/docroot">
        Options FollowSymLinks
        Order allow,deny
        Allow from all
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheim.direct.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On
    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.es$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]
    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7443 [P]
    ProxyPassReverse /  http://127.0.0.1:7443
    ProxyPreserveHost On
    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    SSLEngine on
    SSLProxyEngine On
    SSLCipherSuite ALL:!ADH:!EXPORT56:-AES256-SHA:-DHE-RSA-AES256-SHA:-DHE-DSS-AES256-SHA:RC4+RSA:+HIGH:+MEDIUM:+LOW:!SSLv2:+EXP:+eNULL
    LogLevel notice
    SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    BrowserMatch ".*MSIE.*" \
                nokeepalive ssl-unclean-shutdown \
                downgrade-1.0 force-response-1.0
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

## ITALY
<VirtualHost *:443>
    ServerName dev.www.manheim.it
    ServerAlias dev.www.manheim.it
    DocumentRoot /export/manheimdirect.com/docroot

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
    <Directory "/">
        Order deny,allow
        Deny from all
    </Directory>
    <Directory "/export/manheimdirect.com/docroot">
        Options FollowSymLinks
        Order allow,deny
        Allow from all
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheim.direct.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On
    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.it$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]
    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7443 [P]
    ProxyPassReverse /  http://127.0.0.1:7443
    ProxyPreserveHost On
    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    SSLEngine on
    SSLProxyEngine On
    SSLCipherSuite ALL:!ADH:!EXPORT56:-AES256-SHA:-DHE-RSA-AES256-SHA:-DHE-DSS-AES256-SHA:RC4+RSA:+HIGH:+MEDIUM:+LOW:!SSLv2:+EXP:+eNULL
    LogLevel notice
    SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    BrowserMatch ".*MSIE.*" \
                nokeepalive ssl-unclean-shutdown \
                downgrade-1.0 force-response-1.0
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

## PORTUGAL
<VirtualHost *:443>
    ServerName dev.www.manheim.pt
    ServerAlias dev.www.manheim.pt
    DocumentRoot /export/manheimdirect.com/docroot

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
    <Directory "/">
        Order deny,allow
        Deny from all
    </Directory>
    <Directory "/export/manheimdirect.com/docroot">
        Options FollowSymLinks
        Order allow,deny
        Allow from all
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheim.direct.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On
    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.pt$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]
    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7443 [P]
    ProxyPassReverse /  http://127.0.0.1:7443
    ProxyPreserveHost On
    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    SSLEngine on
    SSLProxyEngine On
    SSLCipherSuite ALL:!ADH:!EXPORT56:-AES256-SHA:-DHE-RSA-AES256-SHA:-DHE-DSS-AES256-SHA:RC4+RSA:+HIGH:+MEDIUM:+LOW:!SSLv2:+EXP:+eNULL
    LogLevel notice
    SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    BrowserMatch ".*MSIE.*" \
                nokeepalive ssl-unclean-shutdown \
                downgrade-1.0 force-response-1.0
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

## BELGIUM
<VirtualHost *:443>
    ServerName dev.www.manheim.be
    ServerAlias dev.www.manheim.be
    DocumentRoot /export/manheimdirect.com/docroot

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
    <Directory "/">
        Order deny,allow
        Deny from all
    </Directory>
    <Directory "/export/manheimdirect.com/docroot">
        Options FollowSymLinks
        Order allow,deny
        Allow from all
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheim.direct.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On
    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.be$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]
    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7443 [P]
    ProxyPassReverse /  http://127.0.0.1:7443
    ProxyPreserveHost On
    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    SSLEngine on
    SSLProxyEngine On
    SSLCipherSuite ALL:!ADH:!EXPORT56:-AES256-SHA:-DHE-RSA-AES256-SHA:-DHE-DSS-AES256-SHA:RC4+RSA:+HIGH:+MEDIUM:+LOW:!SSLv2:+EXP:+eNULL
    LogLevel notice
    SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    BrowserMatch ".*MSIE.*" \
                nokeepalive ssl-unclean-shutdown \
                downgrade-1.0 force-response-1.0
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

## BELGIUM
<VirtualHost *:443>
    ServerName dev.www.manheim.eu
    ServerAlias dev.www.manheim.eu
    DocumentRoot /export/manheimdirect.com/docroot

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
    <Directory "/">
        Order deny,allow
        Deny from all
    </Directory>
    <Directory "/export/manheimdirect.com/docroot">
        Options FollowSymLinks
        Order allow,deny
        Allow from all
    </Directory>

    TransferLog "|/usr/bin/cronolog /export/logs/manheimdirect.com/%Y/%m/%d/spoofBigIp_secure_access_log"
    ErrorLog    "|/usr/bin/cronolog /export/logs/manheim.direct.com/%Y/%m/%d/spoofBigIp_secure_error_log"

    # Turn off proxy requests to prevent spam relaying, etc.
    ProxyRequests Off
    RewriteEngine On
    RewriteCond %{HTTP_HOST} manheim[-]{0,1}europe.com$
    #RewriteCond %{HTTP_HOST} manheim.co.uk$
    RewriteRule ^(.*)$ http://dev.www.manheim.eu$1 [R=permanent,L,NE]
    RewriteRule ^/(images|xml|flash|css|scripts|Pluginlab|admin\/images) - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !.(mpl|html|htm|css|js|gif|jpg|png|txt|pdf|swf)$
    RewriteCond %{REQUEST_URI} !gateway
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ http://%{HTTP_HOST}$1/ [L,R=301]
    ## everything else to the accel server
    RewriteRule ^/(.*) http://127.0.0.1:7443 [P]
    ProxyPassReverse /  http://127.0.0.1:7443
    ProxyPreserveHost On
    SetOutputFilter DEFLATE
    SetEnv gzip-only-text/html 1
    header append Vary User-Agent env=!dont-vary
    SSLEngine on
    SSLProxyEngine On
    SSLCipherSuite ALL:!ADH:!EXPORT56:-AES256-SHA:-DHE-RSA-AES256-SHA:-DHE-DSS-AES256-SHA:RC4+RSA:+HIGH:+MEDIUM:+LOW:!SSLv2:+EXP:+eNULL
    LogLevel notice
    SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    BrowserMatch ".*MSIE.*" \
                nokeepalive ssl-unclean-shutdown \
                downgrade-1.0 force-response-1.0
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
</VirtualHost>

</IfModule>


